@use 'sass:color';
@use 'sass:list';
@use 'sass:math';

@use 'variable' as *;


@function f_clamp($value, $min: $min-linear, $max: $max-linear) {
  @return math.min(math.max($value, $min), $max);
}


@function linear_individual($input) {
  $value                          : f_clamp(($input / $max-rgb));
  $condition                      : ($value <= $gamma-expanded);
  $true                           : ($value / $standard-phi);
  $false                          : (math.pow(($value + $alpha-min) / $alpha-max, $linear-gamma));

  @return if($condition, $true, $false);
}


@function linear($color) {
  $red                            : linear_individual(color.red($color));
  $green                          : linear_individual(color.green($color));
  $blue                           : linear_individual(color.blue($color));

  @return $red, $green, $blue;
}


@function get_luminance($color) {
  $red                            : (list.nth(linear($color), 1) * $linear-red);
  $green                          : (list.nth(linear($color), 2) * $linear-green);
  $blue                           : (list.nth(linear($color), 3) * $linear-blue);
  $luminance                      : f_clamp($red + $green + $blue);

  @return $luminance;
}


@function contrast_ratio($color-a, $color-b) {
  $sum                            : f_clamp($max-linear / 20);
  $luminance-a                    : get_luminance($color-a);
  $luminance-b                    : get_luminance($color-b);
  $get-max                        : (math.max($luminance-a, $luminance-b) + $sum);
  $get-min                        : (math.min($luminance-a, $luminance-b) + $sum);
  $contrast-ratio                 : f_clamp(($get-max / $get-min), $min-accessibility, $max-accessibility);

  @return $contrast-ratio;
}


@function is_dark_or_light($color) {
  $luminance                      : get_luminance($color);
  $condition                      : ($luminance < $tone-bridge);
  $true                           : 'dark';
  $false                          : 'light';

  @return if($condition, $true, $false);
}


@function foreground($background, $foreground: $background, $min-ratio: 7) {

  $background-luminance           : get_luminance($background);
  $foreground-luminance           : get_luminance($foreground);
  $contrast-ratio                 : contrast_ratio($background, $foreground);
  $is-dark-or-light               : is_dark_or_light($background);

  @if ($contrast-ratio < $min-ratio) {

    @if ($is-dark-or-light == 'light') {

      $darkest-test               : contrast_ratio($background, $darkest-color);
      $condition                  : ($darkest-test > $contrast-ratio);
      
      @return if($condition, $darkest-color, $foreground);

    } @else if ($is-dark-or-light == 'dark') {

      $lightest-test              : contrast_ratio($background, $lightest-color);
      $condition                  : ($lightest-test > $contrast-ratio);

      @return if($condition, $lightest-color, $foreground);

    } @else {

      @warn '[ ERROR ]';
      @return inherit;

    }

  }

  @return $foreground;
}


// Material Palette Generator
@function r($color) {
  @return color.red($color);
}

@function g($color) {
  @return color.green($color);
}

@function b($color) {
  @return color.blue($color);
}

@function multiply($color-a, $color-b) {
  $red: math.floor(r($color-a) * r($color-b) / $max-rgb);
  $green: math.floor(g($color-a) * g($color-b) / $max-rgb);
  $blue: math.floor(b($color-a) * b($color-b) / $max-rgb);
  
  @return rgb($red, $green, $blue);
}

@function base_light($color: $lightest-color) {
  @return $color;
}

@function base_dark($color: $demo-color) {
  @return multiply($color, $color);
}

@function base_triad($color: $demo-color) {
  $h: color.hue($color);
  $h: (($h + 270) % 360);

  @return color.change($color, $hue: $h);
}


@function c_50($color) {
  $color: color.mix($color, base_light(), 12%);
  @return $color;
}

@function c_100($color) {
  $color: color.mix($color, base_light(), 30%);
  @return $color;
}

@function c_200($color) {
  $color: color.mix($color, base_light(), 50%);
  @return $color;
}

@function c_300($color) {
  $color: color.mix($color, base_lignt(), 70%);
  @return $color;
}

@function c_400($color) {
  $color: color.mix($color, base_light(), 85%);
  @return $color;
}

@function c_500($color) {
  $color: color.mix($color, base_light(), 100%);
  @return $color;
}

@function c_600($color) {
  $color: color.mix($color, base_dark($color), 87%);
  @return $color;
}

@function c_700($color) {
  $color: color.mix($color, base_dark($color), 70%);
  @return $color;
}

@function c_800($color) {
  $color: color.mix($color, base_dark($color), 54%);
  @return $color;
}

@function c_900($color) {
  $color: color.mix($color, base_dark($color), 25%);
  @return $color;
}
